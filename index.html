<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·¥ä½œæ—¶é—´ä¸åŠ ç­ç»Ÿè®¡ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f6fa;
            color: #333;
        }
        
        .container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        /* æ–°å¢æ¬¢è¿åŒºåŸŸæ ·å¼ */
        .welcome-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .welcome-title {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .welcome-subtitle {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 15px;
        }
        
        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .feature-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .user-guide {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #3498db;
        }
        
        .guide-step {
            margin: 10px 0;
            padding: 8px;
            background: white;
            border-radius: 5px;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #2c3e50;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .input-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .time-group {
            display: flex;
            align-items: center;
            gap: 5px;
            background: white;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ddd;
            margin: 5px 0;
        }
        
        input, select, button {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #3498db;
        }
        
        button {
            background: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        .delete-btn {
            background: #e74c3c;
            padding: 5px 10px;
            font-size: 12px;
        }
        
        .delete-btn:hover {
            background: #c0392b;
        }
        
        .export-btn {
            background: #27ae60;
        }
        
        .export-btn:hover {
            background: #219a52;
        }
        
        .punch-btn {
            background: #e67e22;
            font-size: 16px;
            padding: 12px 20px;
            margin: 10px 0;
        }
        
        .punch-btn:hover {
            background: #d35400;
        }
        
        .punch-section {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: #fff3cd;
            border-radius: 8px;
            border: 1px solid #ffeaa7;
        }
        
        .punch-time {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        
        .stats-section {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .stat-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: bold;
            margin-top: 5px;
        }
        
        .calendar-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .calendar-title {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .calendar-nav {
            display: flex;
            gap: 10px;
        }
        
        .calendar-nav button {
            background: #34495e;
            padding: 5px 10px;
            font-size: 12px;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        
        .calendar-weekday {
            text-align: center;
            padding: 8px;
            background: #ecf0f1;
            font-weight: bold;
            font-size: 12px;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            padding: 5px;
            border: 1px solid #ecf0f1;
            cursor: pointer;
            font-size: 12px;
            position: relative;
        }
        
        .calendar-day:hover {
            background: #f8f9fa;
        }
        
        .day-number {
            font-weight: bold;
        }
        
        .day-status {
            font-size: 10px;
            margin-top: 2px;
        }
        
        .work-status {
            color: #27ae60;
        }
        
        .leave-status {
            color: #e74c3c;
        }
        
        .rest-status {
            color: #7f8c8d;
        }
        
        .today {
            background: #3498db;
            color: white;
        }
        
        .other-month {
            color: #bdc3c7;
        }
        
        .records-section h3 {
            margin-bottom: 15px;
            color: #2c3e50;
        }
        
        .record-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            border-left: 4px solid #3498db;
        }
        
        .record-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .record-date {
            font-weight: bold;
            color: #2c3e50;
            font-size: 16px;
        }
        
        .record-type {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .work-day {
            background: #3498db;
            color: white;
        }
        
        .rest-day {
            background: #27ae60;
            color: white;
        }
        
        .leave-day {
            background: #9b59b6;
            color: white;
        }
        
        .time-blocks {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .time-block {
            background: white;
            padding: 10px;
            border-radius: 5px;
        }
        
        .normal-work {
            border-left: 3px solid #3498db;
        }
        
        .lunch-break {
            border-left: 3px solid #f39c12;
        }
        
        .overtime {
            border-left: 3px solid #e74c3c;
        }
        
        .leave-block {
            border-left: 3px solid #9b59b6;
        }
        
        .block-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .block-time {
            color: #666;
            font-size: 14px;
        }
        
        .block-duration {
            color: #e74c3c;
            font-weight: bold;
            font-size: 14px;
        }
        
        .leave-duration {
            color: #9b59b6;
            font-weight: bold;
            font-size: 14px;
        }
        
        .record-total {
            text-align: right;
            font-weight: bold;
            color: #2c3e50;
            border-top: 1px solid #eee;
            padding-top: 10px;
            margin-top: 10px;
            font-size: 16px;
        }
        
        .empty-message {
            text-align: center;
            color: #7f8c8d;
            padding: 40px;
            font-style: italic;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }
        
        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }
        
        .time-section {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 5px;
            border: 1px solid #e0e0e0;
        }
        
        .time-section-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .leave-options {
            display: flex;
            gap: 15px;
            margin-top: 8px;
        }
        
        .leave-option {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        @media (max-width: 900px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .input-group {
                flex-direction: column;
            }
            
            input, select, button {
                width: 100%;
            }
            
            .time-group {
                width: 100%;
                justify-content: space-between;
            }
            
            .leave-options {
                flex-direction: column;
                gap: 8px;
            }
            
            .feature-list {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- æ–°å¢æ¬¢è¿åŒºåŸŸ -->
        <div class="welcome-section">
            <div class="welcome-title">ğŸ‘‹ æ¬¢è¿ä½¿ç”¨å·¥ä½œæ—¶é—´ç»Ÿè®¡ç³»ç»Ÿ</div>
            <div class="welcome-subtitle">ç®€å•æ˜“ç”¨çš„ä¸ªäººå·¥ä½œæ—¶é—´è®°å½•å·¥å…·</div>
            
            <div class="feature-list">
                <div class="feature-item">
                    <div>ğŸ“… æ—¥å†è§†å›¾</div>
                    <small>ç›´è§‚æŸ¥çœ‹æœˆåº¦è€ƒå‹¤</small>
                </div>
                <div class="feature-item">
                    <div>â° ä¸€é”®æ‰“å¡</div>
                    <small>å¿«é€Ÿè®°å½•å®Œæ•´å·¥ä½œæ—¥</small>
                </div>
                <div class="feature-item">
                    <div>ğŸ“Š æ•°æ®ç»Ÿè®¡</div>
                    <small>è‡ªåŠ¨ç”Ÿæˆæœˆåº¦æŠ¥è¡¨</small>
                </div>
                <div class="feature-item">
                    <div>ğŸ’¾ æœ¬åœ°å­˜å‚¨</div>
                    <small>æ•°æ®å®‰å…¨ä¿å­˜åœ¨æœ¬åœ°</small>
                </div>
            </div>
        </div>
        
        <!-- ä½¿ç”¨æŒ‡å— -->
        <div class="user-guide">
            <h3>ğŸ“– ä½¿ç”¨æŒ‡å—</h3>
            <div class="guide-step">1. <strong>ä¸€é”®æ‰“å¡</strong>ï¼šç‚¹å‡»æ©™è‰²æŒ‰é’®å¿«é€Ÿè®°å½•æ ‡å‡†å·¥ä½œæ—¥</div>
            <div class="guide-step">2. <strong>æ‰‹åŠ¨è®°å½•</strong>ï¼šé€‰æ‹©æ—¥æœŸå’Œå·¥ä½œç±»å‹ï¼Œè‡ªå®šä¹‰å·¥ä½œæ—¶é—´</div>
            <div class="guide-step">3. <strong>è¯·å‡è®°å½•</strong>ï¼šé€‰æ‹©è¯·å‡ç±»å‹ï¼Œæ”¯æŒå…¨å¤©/ä¸Šåˆ/ä¸‹åˆè¯·å‡</div>
            <div class="guide-step">4. <strong>æŸ¥çœ‹ç»Ÿè®¡</strong>ï¼šå®æ—¶æŸ¥çœ‹æœˆåº¦å·¥ä½œç»Ÿè®¡</div>
            <div class="guide-step">5. <strong>å¯¼å‡ºæ•°æ®</strong>ï¼šç‚¹å‡»å¯¼å‡ºæŒ‰é’®ç”ŸæˆExcelæŠ¥è¡¨</div>
        </div>

        <h1>ğŸ“Š æ¯æ—¥å·¥ä½œè®°å½•</h1>
        
        <div class="dashboard">
            <div class="stats-section">
                <h2>æœ¬æœˆç»Ÿè®¡æ±‡æ€»</h2>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div>å·¥ä½œå¤©æ•°</div>
                        <div class="stat-value" id="totalWorkDays">0 å¤©</div>
                    </div>
                    <div class="stat-item">
                        <div>è¯·å‡æ—¶é—´</div>
                        <div class="stat-value" id="totalLeaveHours">0 å°æ—¶</div>
                    </div>
                    <div class="stat-item">
                        <div>ä¼‘æ¯å¤©æ•°</div>
                        <div class="stat-value" id="totalRestDays">0 å¤©</div>
                    </div>
                    <div class="stat-item">
                        <div>åŠ ç­æ—¶é—´</div>
                        <div class="stat-value" id="totalOvertimeHours">0 å°æ—¶</div>
                    </div>
                </div>
                
                <!-- æ‰“å¡åŒºåŸŸ -->
                <div class="punch-section">
                    <button class="punch-btn" onclick="punchCard()">ğŸš€ ä¸€é”®æ‰“å¡</button>
                    <div class="punch-time" id="lastPunchTime">ä»Šæ—¥å°šæœªæ‰“å¡</div>
                </div>
            </div>
            
            <div class="calendar-section">
                <div class="calendar-header">
                    <div class="calendar-title" id="calendarTitle">2023å¹´12æœˆ</div>
                    <div class="calendar-nav">
                        <button onclick="changeMonth(-1)">ä¸Šä¸ªæœˆ</button>
                        <button onclick="changeMonth(1)">ä¸‹ä¸ªæœˆ</button>
                    </div>
                </div>
                <div class="calendar-grid" id="calendarGrid">
                    <!-- æ—¥å†ç”±JavaScriptç”Ÿæˆ -->
                </div>
            </div>
        </div>
        
        <div class="input-section">
            <div class="input-group">
                <input type="date" id="dateInput" value="">
                <select id="dayType" onchange="toggleTimeInputs()">
                    <option value="work">å·¥ä½œæ—¥</option>
                    <option value="rest">ä¼‘æ¯æ—¥</option>
                    <option value="leave">è¯·å‡</option>
                </select>
                <button onclick="addRecord()">ä¿å­˜è®°å½•</button>
            </div>
            
            <div id="timeInputs">
                <!-- è¯·å‡é€‰é¡¹ -->
                <div id="leaveSection" class="time-section" style="display: none;">
                    <div class="time-section-title">è¯·å‡ç±»å‹</div>
                    <div class="leave-options">
                        <label class="leave-option">
                            <input type="radio" name="leaveType" value="all" checked>
                            <span>å…¨å¤©è¯·å‡</span>
                        </label>
                        <label class="leave-option">
                            <input type="radio" name="leaveType" value="morning">
                            <span>ä¸Šåˆè¯·å‡</span>
                        </label>
                        <label class="leave-option">
                            <input type="radio" name="leaveType" value="afternoon">
                            <span>ä¸‹åˆè¯·å‡</span>
                        </label>
                    </div>
                </div>
                
                <!-- ä¸Šåˆå·¥ä½œæ—¶é—´ -->
                <div class="time-section" id="morningSection">
                    <div class="time-section-title">ä¸Šåˆå·¥ä½œ</div>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="morningWorkCheck" checked onchange="toggleMorningWork()">
                            <span>ä¸Šåˆä¸Šç­</span>
                        </label>
                    </div>
                    
                    <div id="morningWorkGroup">
                        <div class="time-group">
                            <span>ä¸Šç­:</span>
                            <select id="morningStart">
                                <option value="08:00">08:00</option>
                                <option value="08:30">08:30</option>
                                <option value="09:00">09:00</option>
                            </select>
                            <span>ä¸‹ç­:</span>
                            <select id="morningEnd">
                                <option value="12:00" selected>12:00</option>
                                <option value="12:30">12:30</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- ä¸­åˆä¼‘æ¯ -->
                <div class="time-section" id="lunchSection">
                    <div class="time-section-title">ä¸­åˆä¼‘æ¯</div>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="lunchBreakCheck" checked onchange="toggleLunchBreak()">
                            <span>åˆä¼‘æ—¶é—´</span>
                        </label>
                    </div>
                    
                    <div id="lunchBreakGroup">
                        <div class="time-group">
                            <span>å¼€å§‹:</span>
                            <select id="lunchStart">
                                <option value="12:00" selected>12:00</option>
                                <option value="12:30">12:30</option>
                            </select>
                            <span>ç»“æŸ:</span>
                            <select id="lunchEnd">
                                <option value="13:00">13:00</option>
                                <option value="13:30" selected>13:30</option>
                                <option value="14:00">14:00</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- ä¸‹åˆå·¥ä½œæ—¶é—´ -->
                <div class="time-section" id="afternoonSection">
                    <div class="time-section-title">ä¸‹åˆå·¥ä½œ</div>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="afternoonWorkCheck" checked onchange="toggleAfternoonWork()">
                            <span>ä¸‹åˆä¸Šç­</span>
                        </label>
                    </div>
                    
                    <div id="afternoonWorkGroup">
                        <div class="time-group">
                            <span>ä¸Šç­:</span>
                            <select id="afternoonStart">
                                <option value="13:30" selected>13:30</option>
                                <option value="14:00">14:00</option>
                            </select>
                            <span>ä¸‹ç­:</span>
                            <select id="afternoonEnd">
                                <option value="17:00">17:00</option>
                                <option value="17:30" selected>17:30</option>
                                <option value="18:00">18:00</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- æ™šä¸ŠåŠ ç­ -->
                <div class="time-section" id="overtimeSection">
                    <div class="time-section-title">æ™šä¸ŠåŠ ç­</div>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="overtimeCheck" onchange="toggleOvertime()">
                            <span>æ™šä¸ŠåŠ ç­</span>
                        </label>
                    </div>
                    
                    <div id="overtimeGroup" style="display: none;">
                        <div class="time-group">
                            <span>å¼€å§‹:</span>
                            <select id="overtimeStart">
                                <option value="18:30">18:30</option>
                                <option value="19:00">19:00</option>
                                <option value="19:30">19:30</option>
                                <option value="20:00">20:00</option>
                            </select>
                            <span>ç»“æŸ:</span>
                            <select id="overtimeEnd">
                                <option value="20:00">20:00</option>
                                <option value="20:30">20:30</option>
                                <option value="21:00">21:00</option>
                                <option value="21:30" selected>21:30</option>
                                <option value="22:00">22:00</option>
                                <option value="22:30">22:30</option>
                                <option value="23:00">23:00</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="input-group">
                <button class="export-btn" onclick="exportToExcel()">ğŸ“Š å¯¼å‡ºExcelè¡¨æ ¼</button>
                <button onclick="clearAllData()" style="background: #95a5a6;">æ¸…ç©ºæ‰€æœ‰æ•°æ®</button>
            </div>
        </div>
        
        <div class="records-section">
            <h3>è®°å½•åˆ—è¡¨</h3>
            <div id="recordsList">
                <!-- è®°å½•åˆ—è¡¨ç”±JavaScriptç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <script>
        let currentCalendarDate = new Date();
        
        // ä¸ºä¸åŒç”¨æˆ·ç”Ÿæˆå”¯ä¸€æ ‡è¯†ç¬¦
        function getUserId() {
            let userId = localStorage.getItem('workRecordUserId');
            if (!userId) {
                userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('workRecordUserId', userId);
            }
            return userId;
        }

        // ä¿®æ”¹æ•°æ®å­˜å‚¨é”®åï¼ŒåŠ å…¥ç”¨æˆ·ID
        function getStorageKey() {
            return 'workRecords_' + getUserId();
        }
        
        // è®¾ç½®é»˜è®¤æ—¥æœŸä¸ºä»Šå¤©
        function setDefaultDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dateInput').value = today;
        }

        // åˆ‡æ¢æ—¶é—´è¾“å…¥æ¡†æ˜¾ç¤º
        function toggleTimeInputs() {
            const dayType = document.getElementById('dayType').value;
            const timeInputs = document.getElementById('timeInputs');
            const leaveSection = document.getElementById('leaveSection');
            const morningSection = document.getElementById('morningSection');
            const lunchSection = document.getElementById('lunchSection');
            const afternoonSection = document.getElementById('afternoonSection');
            const overtimeSection = document.getElementById('overtimeSection');
            
            if (dayType === 'rest') {
                timeInputs.style.display = 'none';
            } else if (dayType === 'leave') {
                timeInputs.style.display = 'block';
                leaveSection.style.display = 'block';
                morningSection.style.display = 'block';
                lunchSection.style.display = 'block';
                afternoonSection.style.display = 'block';
                overtimeSection.style.display = 'block';
            } else {
                timeInputs.style.display = 'block';
                leaveSection.style.display = 'none';
                morningSection.style.display = 'block';
                lunchSection.style.display = 'block';
                afternoonSection.style.display = 'block';
                overtimeSection.style.display = 'block';
            }
        }

        // åˆ‡æ¢ä¸Šåˆå·¥ä½œæ—¶é—´
        function toggleMorningWork() {
            const checked = document.getElementById('morningWorkCheck').checked;
            document.getElementById('morningWorkGroup').style.display = checked ? 'block' : 'none';
        }

        // åˆ‡æ¢åˆä¼‘æ—¶é—´
        function toggleLunchBreak() {
            const checked = document.getElementById('lunchBreakCheck').checked;
            document.getElementById('lunchBreakGroup').style.display = checked ? 'block' : 'none';
        }

        // åˆ‡æ¢ä¸‹åˆå·¥ä½œæ—¶é—´
        function toggleAfternoonWork() {
            const checked = document.getElementById('afternoonWorkCheck').checked;
            document.getElementById('afternoonWorkGroup').style.display = checked ? 'block' : 'none';
        }

        // åˆ‡æ¢åŠ ç­æ—¶é—´
        function toggleOvertime() {
            const checked = document.getElementById('overtimeCheck').checked;
            document.getElementById('overtimeGroup').style.display = checked ? 'block' : 'none';
        }

        // è®¡ç®—å·¥ä½œæ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
        function calculateDuration(startTime, endTime) {
            const start = parseTime(startTime);
            const end = parseTime(endTime);
            return Math.max(0, end - start);
        }

        // è§£ææ—¶é—´å­—ç¬¦ä¸²ä¸ºåˆ†é’Ÿæ•°
        function parseTime(timeStr) {
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours * 60 + minutes;
        }

        // æ ¼å¼åŒ–æ—¶é•¿ä¸ºå°æ—¶æ˜¾ç¤º
        function formatDuration(minutes) {
            return (minutes / 60).toFixed(1) + 'å°æ—¶';
        }

        // è·å–è¯·å‡ç±»å‹
        function getLeaveType() {
            const leaveType = document.querySelector('input[name="leaveType"]:checked').value;
            return leaveType;
        }

        // æ‰“å¡åŠŸèƒ½
        function punchCard() {
            const today = new Date().toISOString().split('T')[0];
            const records = getRecords();
            
            // æ£€æŸ¥ä»Šå¤©æ˜¯å¦å·²æœ‰è®°å½•
            const existingRecord = records.find(r => r.date === today);
            if (existingRecord) {
                if (!confirm('ä»Šå¤©å·²æœ‰è®°å½•ï¼Œæ˜¯å¦è¦†ç›–ï¼Ÿ')) {
                    return;
                }
            }
            
            // åˆ›å»ºå®Œæ•´çš„æ‰“å¡è®°å½•ï¼ˆä¸‹åˆå·¥ä½œæ—¶é—´æ”¹ä¸º17:30ï¼‰
            const record = {
                id: Date.now(),
                date: today,
                dayType: 'work',
                morningWork: {
                    start: '08:00',
                    end: '12:00',
                    duration: calculateDuration('08:00', '12:00')
                },
                lunchBreak: {
                    start: '12:00',
                    end: '13:30',
                    duration: calculateDuration('12:00', '13:30')
                },
                afternoonWork: {
                    start: '13:30',
                    end: '17:30', // æ”¹ä¸º17:30
                    duration: calculateDuration('13:30', '17:30')
                },
                overtime: {
                    start: '18:30',
                    end: '21:30',
                    duration: calculateDuration('18:30', '21:30')
                },
                leaveType: null
            };
            
            // ä¿å­˜è®°å½•
            const existingIndex = records.findIndex(r => r.date === today);
            if (existingIndex > -1) {
                records[existingIndex] = record;
            } else {
                records.push(record);
            }
            
            localStorage.setItem(getStorageKey(), JSON.stringify(records));
            
            // æ›´æ–°æœ€åæ‰“å¡æ—¶é—´
            const now = new Date();
            const punchTime = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            localStorage.setItem('lastPunchTime_' + getUserId(), punchTime);
            document.getElementById('lastPunchTime').textContent = `ä¸Šæ¬¡æ‰“å¡æ—¶é—´: ${punchTime}`;
            
            // åˆ·æ–°æ˜¾ç¤º
            displayRecords();
            updateStatistics();
            renderCalendar();
            
            alert('æ‰“å¡æˆåŠŸï¼å·²è®°å½•å®Œæ•´å·¥ä½œæ—¥æ—¶é—´ã€‚\n\nå·¥ä½œæ—¶é—´è¯¦æƒ…ï¼š\n- ä¸Šåˆï¼š8:00-12:00 (4å°æ—¶)\n- ä¸‹åˆï¼š13:30-17:30 (4å°æ—¶)\n- åŠ ç­ï¼š18:30-21:30 (3å°æ—¶)\n- æ€»è®¡ï¼š11å°æ—¶');
        }

        // æ›´æ–°æœ€åæ‰“å¡æ—¶é—´æ˜¾ç¤º
        function updateLastPunchTime() {
            const lastPunch = localStorage.getItem('lastPunchTime_' + getUserId());
            if (lastPunch) {
                document.getElementById('lastPunchTime').textContent = `ä¸Šæ¬¡æ‰“å¡æ—¶é—´: ${lastPunch}`;
            }
        }

        // æ·»åŠ è®°å½•
        function addRecord() {
            const date = document.getElementById('dateInput').value;
            const dayType = document.getElementById('dayType').value;
            
            if (!date) {
                alert('è¯·é€‰æ‹©æ—¥æœŸ');
                return;
            }

            let record = {
                id: Date.now(),
                date: date,
                dayType: dayType,
                morningWork: null,
                lunchBreak: null,
                afternoonWork: null,
                overtime: null,
                leaveType: null
            };

            // ä¸Šåˆå·¥ä½œï¼ˆè¯·å‡æ—¶ä¹Ÿå¯ä»¥è®°å½•ï¼‰
            if (document.getElementById('morningWorkCheck').checked) {
                const morningStart = document.getElementById('morningStart').value;
                const morningEnd = document.getElementById('morningEnd').value;
                const morningDuration = calculateDuration(morningStart, morningEnd);
                
                record.morningWork = {
                    start: morningStart,
                    end: morningEnd,
                    duration: morningDuration
                };
            }

            // åˆä¼‘æ—¶é—´
            if (document.getElementById('lunchBreakCheck').checked) {
                const lunchStart = document.getElementById('lunchStart').value;
                const lunchEnd = document.getElementById('lunchEnd').value;
                const lunchDuration = calculateDuration(lunchStart, lunchEnd);
                
                record.lunchBreak = {
                    start: lunchStart,
                    end: lunchEnd,
                    duration: lunchDuration
                };
            }

            // ä¸‹åˆå·¥ä½œï¼ˆè¯·å‡æ—¶ä¹Ÿå¯ä»¥è®°å½•ï¼‰
            if (document.getElementById('afternoonWorkCheck').checked) {
                const afternoonStart = document.getElementById('afternoonStart').value;
                const afternoonEnd = document.getElementById('afternoonEnd').value;
                const afternoonDuration = calculateDuration(afternoonStart, afternoonEnd);
                
                record.afternoonWork = {
                    start: afternoonStart,
                    end: afternoonEnd,
                    duration: afternoonDuration
                };
            }

            // åŠ ç­
            if (document.getElementById('overtimeCheck').checked) {
                const overtimeStart = document.getElementById('overtimeStart').value;
                const overtimeEnd = document.getElementById('overtimeEnd').value;
                const overtimeDuration = calculateDuration(overtimeStart, overtimeEnd);
                
                record.overtime = {
                    start: overtimeStart,
                    end: overtimeEnd,
                    duration: overtimeDuration
                };
            }

            // è¯·å‡ç±»å‹
            if (dayType === 'leave') {
                record.leaveType = getLeaveType();
                
                // æ ¹æ®è¯·å‡ç±»å‹è‡ªåŠ¨è°ƒæ•´å·¥ä½œæ—¶é—´æ®µ
                if (record.leaveType === 'morning') {
                    // ä¸Šåˆè¯·å‡ï¼Œè‡ªåŠ¨å–æ¶ˆä¸Šåˆå·¥ä½œ
                    record.morningWork = null;
                } else if (record.leaveType === 'afternoon') {
                    // ä¸‹åˆè¯·å‡ï¼Œè‡ªåŠ¨å–æ¶ˆä¸‹åˆå·¥ä½œ
                    record.afternoonWork = null;
                } else if (record.leaveType === 'all') {
                    // å…¨å¤©è¯·å‡ï¼Œå–æ¶ˆæ‰€æœ‰å·¥ä½œ
                    record.morningWork = null;
                    record.afternoonWork = null;
                    record.overtime = null;
                }
            }

            // æ£€æŸ¥æ˜¯å¦è‡³å°‘æœ‰ä¸€ä¸ªå·¥ä½œæ—¶é—´æ®µï¼ˆé™¤äº†å…¨å¤©è¯·å‡ï¼‰
            if (dayType !== 'leave' || record.leaveType !== 'all') {
                if (!record.morningWork && !record.afternoonWork && !record.overtime) {
                    alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªå·¥ä½œæ—¶é—´æ®µ');
                    return;
                }
            }

            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            const records = getRecords();
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨åŒæ—¥æœŸçš„è®°å½•
            const existingIndex = records.findIndex(r => r.date === date);
            if (existingIndex > -1) {
                records[existingIndex] = record; // æ›´æ–°è®°å½•
            } else {
                records.push(record); // æ–°å¢è®°å½•
            }
            
            localStorage.setItem(getStorageKey(), JSON.stringify(records));
            
            // åˆ·æ–°æ˜¾ç¤º
            displayRecords();
            updateStatistics();
            renderCalendar();
            alert('è®°å½•ä¿å­˜æˆåŠŸï¼');
        }

        // åˆ é™¤è®°å½•
        function deleteRecord(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) {
                const records = getRecords().filter(record => record.id !== id);
                localStorage.setItem(getStorageKey(), JSON.stringify(records));
                displayRecords();
                updateStatistics();
                renderCalendar();
            }
        }

        // è·å–æ‰€æœ‰è®°å½•
        function getRecords() {
            const stored = localStorage.getItem(getStorageKey());
            return stored ? JSON.parse(stored) : [];
        }

        // æ˜¾ç¤ºè®°å½•åˆ—è¡¨
        function displayRecords() {
            const records = getRecords();
            const recordsList = document.getElementById('recordsList');
            
            if (records.length === 0) {
                recordsList.innerHTML = '<div class="empty-message">æš‚æ— è®°å½•ï¼Œæ·»åŠ ç¬¬ä¸€æ¡è®°å½•å§ï¼</div>';
                return;
            }

            // æŒ‰æ—¥æœŸæ’åºï¼ˆæœ€æ–°çš„åœ¨å‰é¢ï¼‰
            records.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            recordsList.innerHTML = records.map(record => `
                <div class="record-item">
                    <div class="record-header">
                        <div>
                            <span class="record-date">${record.date}</span>
                            <span class="record-type ${record.dayType === 'work' ? 'work-day' : record.dayType === 'leave' ? 'leave-day' : 'rest-day'}">
                                ${record.dayType === 'work' ? 'å·¥ä½œæ—¥' : record.dayType === 'leave' ? 'è¯·å‡' : 'ä¼‘æ¯æ—¥'}
                                ${record.leaveType ? `(${record.leaveType === 'all' ? 'å…¨å¤©' : record.leaveType === 'morning' ? 'ä¸Šåˆ' : 'ä¸‹åˆ'})` : ''}
                            </span>
                        </div>
                        <button class="delete-btn" onclick="deleteRecord(${record.id})">åˆ é™¤</button>
                    </div>
                    
                    ${record.dayType !== 'rest' ? `
                        <div class="time-blocks">
                            ${record.morningWork ? `
                                <div class="time-block normal-work">
                                    <div class="block-title">ä¸Šåˆå·¥ä½œ</div>
                                    <div class="block-time">${record.morningWork.start} - ${record.morningWork.end}</div>
                                    <div class="block-duration">${formatDuration(record.morningWork.duration)}</div>
                                </div>
                            ` : ''}
                            
                            ${record.lunchBreak ? `
                                <div class="time-block lunch-break">
                                    <div class="block-title">åˆä¼‘æ—¶é—´</div>
                                    <div class="block-time">${record.lunchBreak.start} - ${record.lunchBreak.end}</div>
                                    <div class="block-duration">${formatDuration(record.lunchBreak.duration)}</div>
                                </div>
                            ` : ''}
                            
                            ${record.afternoonWork ? `
                                <div class="time-block normal-work">
                                    <div class="block-title">ä¸‹åˆå·¥ä½œ</div>
                                    <div class="block-time">${record.afternoonWork.start} - ${record.afternoonWork.end}</div>
                                    <div class="block-duration">${formatDuration(record.afternoonWork.duration)}</div>
                                </div>
                            ` : ''}
                            
                            ${record.overtime ? `
                                <div class="time-block overtime">
                                    <div class="block-title">æ™šä¸ŠåŠ ç­</div>
                                    <div class="block-time">${record.overtime.start} - ${record.overtime.end}</div>
                                    <div class="block-duration">${formatDuration(record.overtime.duration)}</div>
                                </div>
                            ` : ''}
                            
                            ${record.leaveType ? `
                                <div class="time-block leave-block">
                                    <div class="block-title">è¯·å‡ä¿¡æ¯</div>
                                    <div class="block-time">
                                        ${record.leaveType === 'all' ? 'å…¨å¤©è¯·å‡' : 
                                          record.leaveType === 'morning' ? 'ä¸Šåˆè¯·å‡' : 'ä¸‹åˆè¯·å‡'}
                                    </div>
                                    <div class="leave-duration">
                                        ${record.leaveType === 'all' ? '1å¤©' : '0.5å¤©'}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                        
                        ${record.dayType === 'leave' && record.leaveType !== 'all' ? `
                            <div class="record-total">
                                å½“æ—¥æ€»è®¡å·¥ä½œæ—¶é—´: ${formatDuration(
                                    (record.morningWork ? record.morningWork.duration : 0) + 
                                    (record.afternoonWork ? record.afternoonWork.duration : 0) +
                                    (record.overtime ? record.overtime.duration : 0)
                                )}
                            </div>
                        ` : record.dayType === 'work' ? `
                            <div class="record-total">
                                å½“æ—¥æ€»è®¡å·¥ä½œæ—¶é—´: ${formatDuration(
                                    (record.morningWork ? record.morningWork.duration : 0) + 
                                    (record.afternoonWork ? record.afternoonWork.duration : 0) +
                                    (record.overtime ? record.overtime.duration : 0)
                                )}
                            </div>
                        ` : ''}
                    ` : `
                        <div style="color: #27ae60; font-style: italic;">ğŸ’¤ ä¼‘æ¯æ—¥</div>
                    `}
                </div>
            `).join('');
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStatistics() {
            const records = getRecords();
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            const monthRecords = records.filter(record => {
                const recordDate = new Date(record.date);
                return recordDate.getMonth() === currentMonth && recordDate.getFullYear() === currentYear;
            });
            
            // å·¥ä½œå¤©æ•°ï¼ˆæœ‰å·¥ä½œè®°å½•çš„æ—¥æœŸï¼‰
            const workDays = monthRecords.filter(r => r.dayType === 'work').length;
            
            // ä¼‘æ¯å¤©æ•°
            const restDays = monthRecords.filter(r => r.dayType === 'rest').length;
            
            // è¯·å‡æ—¶é—´ï¼ˆå°æ—¶ï¼‰
            let totalLeaveHours = 0;
            monthRecords.forEach(record => {
                if (record.dayType === 'leave') {
                    if (record.leaveType === 'all') {
                        totalLeaveHours += 8; // å…¨å¤©è¯·å‡ç®—8å°æ—¶
                    } else {
                        totalLeaveHours += 4; // åŠå¤©è¯·å‡ç®—4å°æ—¶
                    }
                }
            });
            
            // åŠ ç­æ—¶é—´
            let totalOvertimeHours = 0;
            monthRecords.forEach(record => {
                if (record.overtime) {
                    totalOvertimeHours += record.overtime.duration / 60;
                }
            });

            document.getElementById('totalWorkDays').textContent = workDays + ' å¤©';
            document.getElementById('totalLeaveHours').textContent = totalLeaveHours.toFixed(1) + ' å°æ—¶';
            document.getElementById('totalRestDays').textContent = restDays + ' å¤©';
            document.getElementById('totalOvertimeHours').textContent = totalOvertimeHours.toFixed(1) + ' å°æ—¶';
        }

        // æ¸²æŸ“æ—¥å†
        function renderCalendar() {
            const calendarGrid = document.getElementById('calendarGrid');
            const calendarTitle = document.getElementById('calendarTitle');
            
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            // è®¾ç½®æ—¥å†æ ‡é¢˜
            calendarTitle.textContent = `${year}å¹´${month + 1}æœˆ`;
            
            // è·å–å½“æœˆç¬¬ä¸€å¤©å’Œæœ€åä¸€å¤©
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            
            // è·å–å½“æœˆç¬¬ä¸€å¤©æ˜¯æ˜ŸæœŸå‡ ï¼ˆ0æ˜¯å‘¨æ—¥ï¼Œ6æ˜¯å‘¨å…­ï¼‰
            const firstDayOfWeek = firstDay.getDay();
            
            // è·å–ä¸Šä¸ªæœˆçš„æœ€åå‡ å¤©
            const prevMonthLastDay = new Date(year, month, 0).getDate();
            
            // æ¸…ç©ºæ—¥å†
            calendarGrid.innerHTML = '';
            
            // æ·»åŠ æ˜ŸæœŸæ ‡é¢˜
            const weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            weekdays.forEach(day => {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-weekday';
                dayElement.textContent = day;
                calendarGrid.appendChild(dayElement);
            });
            
            // æ·»åŠ ä¸Šä¸ªæœˆçš„æ—¥æœŸ
            for (let i = firstDayOfWeek - 1; i >= 0; i--) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day other-month';
                dayElement.innerHTML = `
                    <div class="day-number">${prevMonthLastDay - i}</div>
                `;
                calendarGrid.appendChild(dayElement);
            }
            
            // æ·»åŠ å½“æœˆçš„æ—¥æœŸ
            const records = getRecords();
            const today = new Date();
            
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const dateStr = `${year}-${(month + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                const record = records.find(r => r.date === dateStr);
                
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                
                // æ£€æŸ¥æ˜¯å¦æ˜¯ä»Šå¤©
                if (today.getFullYear() === year && today.getMonth() === month && today.getDate() === day) {
                    dayElement.classList.add('today');
                }
                
                let statusText = '';
                let statusClass = '';
                
                if (record) {
                    if (record.dayType === 'work') {
                        statusText = 'å·¥ä½œ';
                        statusClass = 'work-status';
                    } else if (record.dayType === 'leave') {
                        statusText = record.leaveType === 'all' ? 'å…¨å¤©å‡' : 
                                   record.leaveType === 'morning' ? 'ä¸Šåˆå‡' : 'ä¸‹åˆå‡';
                        statusClass = 'leave-status';
                    } else if (record.dayType === 'rest') {
                        statusText = 'ä¼‘æ¯';
                        statusClass = 'rest-status';
                    }
                }
                
                dayElement.innerHTML = `
                    <div class="day-number">${day}</div>
                    ${statusText ? `<div class="day-status ${statusClass}">${statusText}</div>` : ''}
                `;
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                dayElement.onclick = () => {
                    document.getElementById('dateInput').value = dateStr;
                    // è‡ªåŠ¨é€‰æ‹©å¯¹åº”çš„æ—¥æœŸç±»å‹
                    if (record) {
                        document.getElementById('dayType').value = record.dayType;
                        toggleTimeInputs();
                    }
                };
                
                calendarGrid.appendChild(dayElement);
            }
            
            // æ·»åŠ ä¸‹ä¸ªæœˆçš„æ—¥æœŸï¼ˆè¡¥é½å‰©ä½™æ ¼å­ï¼‰
            const totalCells = 42; // 6è¡Œ * 7åˆ—
            const remainingCells = totalCells - firstDayOfWeek - lastDay.getDate();
            
            for (let day = 1; day <= remainingCells; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day other-month';
                dayElement.innerHTML = `
                    <div class="day-number">${day}</div>
                `;
                calendarGrid.appendChild(dayElement);
            }
        }

        // åˆ‡æ¢æœˆä»½
        function changeMonth(direction) {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + direction);
            renderCalendar();
        }

        // å¯¼å‡ºä¸ºExcel
        function exportToExcel() {
            const records = getRecords();
            if (records.length === 0) {
                alert('æ²¡æœ‰æ•°æ®å¯å¯¼å‡º');
                return;
            }

            // æ’åºè®°å½•
            records.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            // åˆ›å»ºCSVå†…å®¹
            let csv = 'æ—¥æœŸ,ç±»å‹,è¯·å‡ç±»å‹,ä¸Šåˆå·¥ä½œæ—¶é—´,ä¸Šåˆå·¥ä½œæ—¶é•¿,åˆä¼‘æ—¶é—´,åˆä¼‘æ—¶é•¿,ä¸‹åˆå·¥ä½œæ—¶é—´,ä¸‹åˆå·¥ä½œæ—¶é•¿,åŠ ç­æ—¶é—´,åŠ ç­æ—¶é•¿,æ€»å·¥ä½œæ—¶é•¿\n';
            
            records.forEach(record => {
                const type = record.dayType === 'work' ? 'å·¥ä½œæ—¥' : record.dayType === 'leave' ? 'è¯·å‡' : 'ä¼‘æ¯æ—¥';
                const leaveType = record.leaveType ? 
                    (record.leaveType === 'all' ? 'å…¨å¤©è¯·å‡' : 
                     record.leaveType === 'morning' ? 'ä¸Šåˆè¯·å‡' : 'ä¸‹åˆè¯·å‡') : '';
                const morningTime = record.morningWork ? `${record.morningWork.start}-${record.morningWork.end}` : '';
                const morningHours = record.morningWork ? (record.morningWork.duration / 60).toFixed(1) : '';
                const lunchTime = record.lunchBreak ? `${record.lunchBreak.start}-${record.lunchBreak.end}` : '';
                const lunchHours = record.lunchBreak ? (record.lunchBreak.duration / 60).toFixed(1) : '';
                const afternoonTime = record.afternoonWork ? `${record.afternoonWork.start}-${record.afternoonWork.end}` : '';
                const afternoonHours = record.afternoonWork ? (record.afternoonWork.duration / 60).toFixed(1) : '';
                const overtime = record.overtime ? `${record.overtime.start}-${record.overtime.end}` : '';
                const overtimeHours = record.overtime ? (record.overtime.duration / 60).toFixed(1) : '';
                
                const totalHours = ((record.morningWork ? record.morningWork.duration : 0) + 
                                   (record.afternoonWork ? record.afternoonWork.duration : 0) +
                                   (record.overtime ? record.overtime.duration : 0)) / 60;
                
                csv += `"${record.date}","${type}","${leaveType}","${morningTime}","${morningHours}","${lunchTime}","${lunchHours}","${afternoonTime}","${afternoonHours}","${overtime}","${overtimeHours}","${totalHours.toFixed(1)}"\n`;
            });

            // æ·»åŠ ç»Ÿè®¡ä¿¡æ¯
            const currentMonth = new Date().getMonth() + 1;
            csv += `\n\n${currentMonth}æœˆç»Ÿè®¡æ±‡æ€»\n`;
            csv += `å·¥ä½œå¤©æ•°,${document.getElementById('totalWorkDays').textContent}\n`;
            csv += `è¯·å‡æ—¶é—´,${document.getElementById('totalLeaveHours').textContent}\n`;
            csv += `ä¼‘æ¯å¤©æ•°,${document.getElementById('totalRestDays').textContent}\n`;
            csv += `åŠ ç­æ—¶é—´,${document.getElementById('totalOvertimeHours').textContent}\n`;

            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `å·¥ä½œè®°å½•_${new Date().toISOString().slice(0,10)}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // æ¸…ç©ºæ‰€æœ‰æ•°æ®
        function clearAllData() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‚¨çš„æ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                localStorage.removeItem(getStorageKey());
                localStorage.removeItem('lastPunchTime_' + getUserId());
                displayRecords();
                updateStatistics();
                renderCalendar();
                document.getElementById('lastPunchTime').textContent = 'ä»Šæ—¥å°šæœªæ‰“å¡';
            }
        }

        // åˆå§‹åŒ–
        function init() {
            setDefaultDate();
            toggleTimeInputs();
            displayRecords();
            updateStatistics();
            renderCalendar();
            updateLastPunchTime();
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = init;
    </script>
</body>
</html>
